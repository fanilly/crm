<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>公告详情</title>
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <script src="./librarys/scripts/rem.js"></script>
  <link rel="stylesheet" type="text/css" href="./librarys/styles/common.css?v={:config('asset_version')}">
  <link rel="stylesheet" type="text/css" href="./librarys/jqweui/lib/weui.css?v={:config('asset_version')}">
  <link rel="stylesheet" type="text/css" href="./librarys/jqweui/css/jquery-weui.css?v={:config('asset_version')}">
  <link rel="stylesheet" type="text/css" href="./styles/public.css?v={:config('asset_version')}">
  <link rel="stylesheet" type="text/css" href="./styles/style.css?v={:config('asset_version')}">
  <link rel="stylesheet" type="text/css" href="./styles/animate.css">
</head>

<body>
  <div class="customer-invitations-detail-page public-wbg" id="app">

    <div class="customer-info">
      <h2 class="public-line-title public-flex-center">
        <span class="public-flex1">关于国庆假放假安排的通知</span>
        <img src="./assets/c23.png" id="more_btn" style="width: .4rem" alt="">
      </h2>
      <div class="info-box">
        <div class="lside">公告类型</div>
        <div class="center">放假公告</div>
      </div>
      <div class="info-box">
        <div class="lside">发布时间</div>
        <div class="center">2018.10.11 15:00</div>
      </div>
      <a href="#" class="info-box">
        <div class="lside">推送人员</div>
        <div class="center">xxxxxxxx</div>
      </a>
      <a class="link-wapper">
        <div class="public-flex-center link-content">
          <img src="./assets/link.png" style="width: .4rem; margin-right: .2rem" alt="" class="lside">
          <div class="public-flex1 public-text-overflow">关于国庆假期好人好事奖励关于国庆假期好人好事奖励关于国庆假期好人好事奖励</div>
        </div>
      </a>
      <div class="public-list-type05">
        <a class="item public-flex-center" style="padding:.1rem .3rem; background-color: transparent;">
          <div class="lside public-bgimg" style="border-radius: 50%; width: .72rem;height: .72rem; background-image: url(./assets/bg.jpg)"></div>
          <div class="center public-flex1">
            <h3 class="title">郭德纲</h3>
            <h6 class="remark" style="padding-top: 0">技术部</h6>
          </div>
          <div class="rside public-flex-center">
            <img src="./assets/a04.png" alt="">
          </div>
        </a>
      </div>
    </div>

    <div class="cremark">
      <div class="title">备注</div>
      <div class="content">暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注暂无备注</div>
      <div class="public-photo">
        <div class="item">
          <div style="background-image: url(./assets/bg.jpg)" class="img public-bgimg"></div>
        </div>
      </div>
    </div>


    <!--==============================
    =            选择人员            =
    ===============================-->

    <div id="choose_push" class="weui-popup__container">
      <div class="weui-popup__overlay"></div>
      <div class="weui-popup__modal weui-popup__modal__fff">
        <div class="public-chose-branch">
          <div class="public-find"><input type="text" placeholder="搜索"></div>
          <div class="public-chose-branch-content">
            <div class="public-input-box-type04 public-flex-center public-bottom-line" @click="handleChooseAllPersons">
              <div :class="{'public-toggle2':true,'public-toggle2-checked':chooseAllPersons}"></div>
              <div class="public-flex1 txt">全选</div>
            </div>
            <div class="group" v-for="item,index in persons">
              <div :class="{'public-input-box-type04':true,'public-flex-center':true,'public-bottom-line':true,active:item.chooseAll,more:item.more}" @click="handleChoosePersonDepartment(index)">
                <div :class="{'public-toggle2':true,'public-toggle2-checked':item.chooseAll}"></div>
                <div class="public-flex1 txt">{{item.name}}</div>
                <div class="public-flex-center" @click.stop.prevent="hanldeShowMorePerson(index)">
                  <div class="remark">{{item.users.length}}人</div>
                  <img src="./assets/a04.png" class="arrow">
                </div>
              </div>
              <div v-if="item.more" v-for="user,i in item.users" class="public-input-box-type04 public-flex-center public-bottom-line" @click="handleChoosePersonItem(index,i)">
                <div :class="{'public-toggle2':true,'public-toggle2-checked':user.choose}"></div>
                <div class="avatar public-bgimg" :style="'background-image: url('+user.avatar+')'"></div>
                <div class="public-flex1 txt">{{user.nickname}}<span class="public-tags-blue" v-if="user.is_supervisor == 1">主管</span></div>
              </div>
            </div>
          </div>
          <div class="confirm-btn-wapper">
            <div class="footer-box">
              <a class="line-btn btn reset close-popup">取消</a>
              <a class="fill-btn btn confirm" @click="handleConfirmChoosePersons">确定</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--====  End of 选择人员  ====-->




  </div>
  <script src="./librarys/scripts/vue.js?v={:config('asset_version')}"></script>
  <script src="./librarys/jqweui/lib/jquery-2.1.4.js?v={:config('asset_version')}"></script>
  <script src="./librarys/jqweui/js/jquery-weui.min.js?v={:config('asset_version')}"></script>
  <script src="./scripts/public.js?v={:config('asset_version')}"></script>
  <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js?v={:config('asset_version')}"></script>
  <script>
  var APP = new Vue({
    el: '#app',
    data: {

      /*=====================================
      =            choose person            =
      =====================================*/
      persons: [],
      chooseAllPersons: false,
      choosedPerson: [],
      /*=====  End of choose person  ======*/
    },
    methods: {

      /*=====================================
      =            choose person            =
      =====================================*/

      handleChoosePersonItem: function(parentIndex, index) {
        var self = this;
        this.persons[parentIndex].users[index].choose = !this.persons[parentIndex].users[index].choose;
        var tempUsers = this.persons[parentIndex].users.filter(function(item, i) {
          return !item.choose;
        });
        this.persons[parentIndex].chooseAll = tempUsers.length == 0 ? true : false;
        var tempPersons = this.persons.filter(function(item, i) {
          return !item.chooseAll;
        });
        this.chooseAllPersons = tempPersons.length == 0 ? true : false;
      },

      hanldeShowMorePerson: function(index) {
        this.persons[index].more = !this.persons[index].more;
      },

      handleConfirmChoosePersons: function() {
        var choosedPerson = [];
        this.persons.forEach(function(item, index) {
          choosedPerson = choosedPerson.concat(item.users.filter(function(ele, i) {
            return ele.choose;
          }))
        });
        this.choosedPerson = choosedPerson;
        $.closePopup();
      },

      handleChoosePersonDepartment: function(index) {
        var self = this;
        this.persons[index].chooseAll = !this.persons[index].chooseAll;
        this.persons[index].users = this.persons[index].users.map(function(item, i) {
          item.choose = self.persons[index].chooseAll;
          return item;
        });
        var tempPersons = this.persons.filter(function(item, i) {
          return !item.chooseAll;
        });
        this.chooseAllPersons = tempPersons.length == 0 ? true : false;
      },

      handleChooseAllPersons: function() {
        var self = this;
        var persons = [];
        this.chooseAllPersons = !this.chooseAllPersons;
        this.persons.forEach(function(item, index) {
          item.chooseAll = self.chooseAllPersons;
          item.users = item.users.map(function(ele, i) {
            ele.choose = self.chooseAllPersons;
            return ele;
          });
          persons.push(item);
        });
        this.persons = persons;
      },

      getRoleUser: function() {
        var self = this;
        $.get('/journal/index/get_role_user', function(res) {
          var persons = [];
          res.data.forEach(function(item, index) {
            item.chooseAll = false;
            item.more = false;
            item.users = item.users.map(function(ele, i) {
              ele.choose = false;
              return ele;
            });
            persons.push(item);
          });
          self.persons = persons;
        })
      },

      /*=====  End of choose person  ======*/

    },

    mounted: function() {
      $('#more_btn').on('click', function() {
        var $self = $(this);
        $.actions({
          actions: [{
            text: "编辑",
            className: 'public-color-success',
            onClick: function() {
              location.href = './noticePublish.html';
            }
          }, {
            text: "删除",
            className: 'public-color-success',
            onClick: function() {
              $.confirm('确认删除？', function() {
                $.showLoading('删除中');
                $.post('#', function(res) {
                  $.hideLoading();
                  $.toast(res.msg, 'text');
                  if (res.code == 1) {
                    location.reload()
                  }
                })
              });
            }
          }, {
            text: "推送",
            className: 'public-color-success',
            onClick: function() {
              $("#choose_push").popup();
            }
          }]
        });
      });
    }
  });

  </script>
</body>

</html>
